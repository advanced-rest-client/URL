<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">

  <base id=base>
  <script src="../url.js"></script>

  <title>url-polyfill playground</title>

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>

  <link rel="import" href="../../iron-demo-helpers/demo-pages-shared-styles.html">
  <link rel="import" href="../../iron-demo-helpers/demo-snippet.html">

  <style is="custom-style" include="demo-pages-shared-styles">

    .vertical-section-container {
      max-width: 900px;
    }

  </style>
</head>
<body unresolved>
  <div class="vertical-section-container centered">
    <h3>url-polyfill playground</h3>
    <demo-snippet>
      <template is="dom-bind" id="app">
        <h4>Protocol</h4>
        <pre>[[computeList(protocols)]]</pre>
        <h4>Path</h4>
        <pre>[[computeList(paths)]]</pre>
        <h4>Search</h4>
        <pre>[[computeList(search)]]</pre>
      </template>
    </demo-snippet>
  </div>
  <script>
  (function(scope) {
    scope.protocols = [];
    scope.paths = [];
    scope.search = [];
    scope.hash = [];
    scope.host = [];

    scope.computeList = function(results) {
      if (!results || !results.length) {
        return 'no results';
      }
      return results.join('\n');
    };

    function id(id) {
      return document.getElementById(id);
    }

    function setBase(base) {
      id('base').href = base;
    }

    function bURL(url) {
      setBase('about:blank');
      var a = document.createElement('a');
      a.setAttribute('href', url);
      return a;
    }

    var noop = {
      protocol: 'undefined',
      href: 'undefined',
      pathname: 'undefined',
      search: 'undefined',
      hash: 'undefined'
    };

    function testProtocol(url) {
      var b = new bURL(url);
      var s;
      try {
        s = new URL(url);
      } catch (e) {
        s = noop;
      }
      var result = b.protocol + ' || ' + s.protocol + ' || ' + b.href;
      scope.protocols.push(result);
    }

    function testPath(url) {
      var b = new bURL(url);
      var s;
      try {
        s = new URL(url);
      } catch (e) {
        s = noop;
      }
      var result = s.pathname + ' || ' + b.pathname;
      scope.paths.push(result);
    }

    function testSearch(url) {
      var b = new bURL(url);
      var s;
      try {
        s = new URL(url);
      } catch (e) {
        s = noop;
      }
      var result = s.search + ' || ' + b.search;
      scope.search.push(result);
    }

    function testHash(url) {
      var b = new bURL(url);
      var s;
      try {
        s = new URL(url);
      } catch (e) {
        s = noop;
      }
      var result = s.hash + ' ' + s.hash.length + ' || ' + b.hash + ' ' +
        b.hash.length;
      scope.hash.push(result);
    }

    function testHost(url) {
      var b = new bURL(url);
      var s;
      try {
        s = new URL(url);
      } catch (e) {
        s = noop;
      }
      var result = s.href + ' || ' + b.href;
      scope.host.push(result);
    }

    function setPathname(path) {
      var s = new URL('data:text/html,test');
      var sb = new bURL('data:text/html,test');
      var z = new URL('http://test/trala/test/b/d');
      var zb = new bURL('http://test/trala/test/b/d');
      var result = s.pathname + ' ' + z.pathname + ' || ' + sb.pathname + ' ' +
        zb.pathname;
      scope.paths.push(result);
      s.pathname = path;
      z.pathname = path;
      sb.pathname = path;
      zb.pathname = path;
      result = s.pathname + ' ' + z.pathname + ' || ' + sb.pathname + ' ' +
        zb.pathname;
      scope.paths.push(result);
    }

    function setSearch(path) {
      var s = new URL('data:text/html,test?x');
      var sb = new bURL('data:text/html,test?x');
      var z = new URL('http://test/trala/test/b/d?x');
      var zb = new bURL('http://test/trala/test/b/d?x');
      var result = s.search + ' ' + z.search + ' || ' + sb.search + ' ' +
        zb.search;
      scope.search.push(result);
      s.search = path;
      z.search = path;
      sb.search = path + 'X';
      zb.search = path + 'X';
      result = s.search + ' ' + z.search + ' || ' + sb.search + ' ' +
        zb.search;
      scope.search.push(result);
    }

    function setScheme(path) {
      var s = new URL('data:text/html,test?x');
      var sb = new bURL('data:text/html,test?x');
      var z = new URL('http://test/trala/test/b/d?x');
      var zb = new bURL('http://test/trala/test/b/d?x');
      var result = s.protocol + ' ' + z.protocol + ' || ' + sb.protocol + ' ' +
        zb.protocol + ' ' + sb.href + ' ' + zb.href;
      scope.protocols.push(result);
      s.protocol = path;
      z.protocol = path;
      sb.protocol = path;
      zb.protocol = path;
      result = s.protocol + ' ' + z.protocol + ' || ' + sb.protocol + ' ' +
        zb.protocol + ' ' + sb.href + ' ' + zb.href;
      scope.protocols.push(result);
    }

    function setHost(path) {
      var z = new URL('http://test/trala/test/b/d?x');
      var zb = new bURL('http://test/trala/test/b/d?x');
      var result = z.host + ' || ' + zb.host + ' ' + zb.href;
      scope.host.push(result);
      z.host = path;
      zb.host = path;
      result = (z.host + ' || ' + zb.host + ' ' + zb.href);
      scope.host.push(result);
    }

    function setHostname(path) {
      var z = new URL('http://x/trala/test/b/d?x');
      var zb = new bURL('http://x/trala/test/b/d?x');
      var result = z.hostname + ' || ' + zb.hostname + ' ' + zb.href;
      scope.host.push(result);
      z.hostname = path;
      zb.hostname = path;
      result = (z.hostname + ' || ' + zb.hostname + ' ' + zb.href);
      scope.host.push(result);
    }

    var protocolTests = [
      'HttPs: test',
      'DATA:test',
      ':test',
      '7:test',
      '™:test',
      'a a:test',
      'unknown:test',
      'unknown :test',
      'A5A.T:x',
      'http:exam™ple.org',
      'http:exam ple.org',
      'http:test',
      'http:test ',
      'http:maraña.org',
      'http://\0example.org/',
      'http://example.org/\0  \ntest',
      'HTTP://m%41rana.org/%41/',
      'http:%FF/',
      'http:&test!/',
      'http:\'',
      'http:xn--test.org/test/test/sd\\f™',
      'http://test/!\'%<>`{|}',
      'http://s/?\\#<>\t!@#'
    ];

    protocolTests.forEach(function(url) {
      testProtocol(url);
    });

    testSearch('http://s/?\\  \t\n\fQ');
    testPath('http://s/  \t\n\f\x0D Q');
    testHash('http://s/#  \t\n\f\x01Q');

    testHost('http://@@@test:900\\/fd');
    testHost('http://test?test');
    testHost('http://test#test');
    testHost('http://test/\\test');
    testHost('http://test:90099991111119/a\\../b//x/./s');
    testHost('datA:\\\'test');
    testHost('http://s/x///../test/');
    testHost('http://s/../x/x');
    testHost('http://example.com:80/');
    testHost('http://Example.com/');
    testHost('http://example.com/%7esmith/');
    testHost('http://example.com:/');
    testHost('http://abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz™/');

    document.write('<br>');
    setPathname('../test/ppp/?../#\\');

    setSearch('??##test');

    setScheme('tralal');
    setScheme('https');
    setScheme('1tes');
    setScheme(' tes');

    setHost('x:34');
    setHost('x:fds');
    setHost('x#');
    setHost('\n');

    setHostname('test:test');
    setHostname('test');
    setHostname('#');
  })(document.getElementById('app'));
  </script>
</body>
</html>
